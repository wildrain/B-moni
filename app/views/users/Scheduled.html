
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Blurbi - Home</title>
	<link rel="shortcut icon" href="../img/favicon.png">
	<link href="../assets/css/bootstrap.min.css" rel="stylesheet" />
	<link href="../assets/css/bootstrap-responsive.min.css" rel="stylesheet" />
	<link rel="stylesheet" href="../assets/css/font-awesome.min.css" />
	<link rel="stylesheet" href="../assets/css/tylerstyle.css" />
	<link rel="stylesheet" href="../assets/css/font.css" />
	<link rel="stylesheet" href="../assets/css/preview.css" />
	<!--ace styles-->
	<link rel="stylesheet" href="../assets/css/fullcalendar.css" />
	<link rel="stylesheet" href="../assets/css/ace.min1.css" />
	<link rel="stylesheet" href="../assets/css/bootstrap-datetimepicker.min.css" />
	<style type="text/css">
.user {
	background:#ffffff;
}
.nav-list > li > a {
background-color: #E9E9E9;
/*color: #585858;*/
display: block;
font-size: 13px;
height: 38px;
line-height: 36px;
padding: 0 16px 0 7px;
text-decoration: none;
text-shadow: none !important;
}
.nav-list > li.active:after {
border-right: none;
bottom: 0;
content: "";
display: inline-block;
position: absolute;
right: -2px;
top: -1px;
}
.nav-list > li.active {
background-color: #FFFFFF;
}
.nav-list > li:first-child {
border-top: 0 none;
}
.nav-list > li.active > a:after {
-moz-border-bottom-colors: none;
-moz-border-left-colors: none;
-moz-border-right-colors: none;
-moz-border-top-colors: none;
border-color: rgba(0, 0, 0, 0) #E9E9E9 rgba(0, 0, 0, 0) rgba(0, 0, 0, 0);
border-image: none;
border-style: solid;
border-width: 14px 10px;
content: "";
display: inline-block;
position: absolute !important;
right: 0;
top: 4px;
}
.widget-body {
border:0;
}
.itemdiv.dialogdiv:before {
    -moz-border-bottom-colors: none;
    -moz-border-left-colors: none;
    -moz-border-right-colors: none;
    -moz-border-top-colors: none;
    border-color: #ffffff;
    border-image: none;
    bottom: 0;
    content: "";
    display: block;
    left: 19px;
    max-width: 0;
    position: absolute;
    top: 0;
    width: 0;
}
.nav-list > li > a:hover {
    background-color: #FFFFFF !important;
    color: #5C983B !important;
}
.nav-list>li>a:hover:before {
	display: block;
	content: "";
	position: absolute;
	top: -1px;
	bottom: 0;
	left: 0;
	width: 3px;
	max-width: 3px;
	overflow: hidden;
	background-color: #5C983B !important;
	color: #5C983B !important;
}
.fc-header-title > h2 {
    color: #5C983B !important;
    font-size: 22px;
}
.fc-state-active, .fc-state-active .fc-button-inner {
    background-color: #5C983B !important;
    border-color: #5C983B !important;
}
a:hover{
    text-decoration: none;
}
.facebook-hover:hover{
   color: gray !important;
}
.twitter-hover:hover{
    color: gray !important;
}
.linkedin-hover:hover{
   color: gray !important;
}
</style>
</head>
<body oncopy="return false" style="padding-top:50px;">
<!--nav bar-->
<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<div class="container-fluid">
				<div class="span2">
					<a href="#">
						<img class="logo" src="../assets/images/betatoplogo125.png">
					</a>
				</div>
			<% include topbar.ejs %>
			</div>
		</div>
</div>
<!--nav bar-->
<!--main container-->
<div class="container-fluid" id="main-container">
<div id="sidebar" style="margin-top: 32px">
<% include sidebar.ejs %>
</div>
<div id="main-content" class="clearfix">
	<div class="row-fluid">
		<div class="span12">
			<!-- PAGE CONTENT BEGINS -->
			<div id="schedule_modal" class="modal hide" style="width: 350px; height: auto;  left:55%; top: 25%" >  
				<div class="modal-header" style="background-color:  #D6E9C0;">  
					<h2 >
						<text id="header">Schedule Post</text>
					</h2>  
				</div>      
				<div class="modal-body" style="color: green">  
					<p >
						Your blurb is now rescheduled. Thanks for posting. <!-- sss $<text id="blurb_price"> </text>-->
					</p> 
					<br>
					<button  data-dismiss="modal" id="bclose_" class="btn btn-success btn-small pull-right">OK</button>
				</div>  
			</div>
			<div id="modal" class="modal hide" style="width: 350px; height: auto;  left:55%; top: 25%" >  
				<div class="modal-header" style="background-color:  #D6E9C0;">  
					<h2 >
						<text id="header">&nbsp</text>
						<button style="color: #CC0000" type="button" id="bclose_" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					</h2>  
				</div>      
				<div class="modal-body" style="color: green">  
					<p id="description">
					</p>  
				</div>
			</div>
			<div id="reblurb_modal" class="modal hide" style="width: 530px; height: auto;  left:50%; top: 25%" >  
				<div class="modal-header" style="height: 50px">  
					<!-- <h2 >
						&nbsp -->
						<!-- <button style="color: #CC0000" type="button" id="bclose" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> -->

						<div class="user" style="width:auto; padding:0 0px;">
															
							<img id="writer_image" class="nav-user-photo" src="../assets/avatars/avatar.png" alt="Jason's Photo" style="width:58px;height:55px; float: left; margin-right: 10px;">

							<div>
							
								<div class="name" style="width:100%; ">
									
									<a href='#'><b id="writer_name" class='green'> </b></a>
									<br>
									<span style="margin-left: 8px; color: #5C983B; font-size: 12px; font-weight: bold"></span>							
								</div>

								<div class="time" style="float: right; margin-top: -39px">
									<button style="color: #CC0000; margin-left: 20px; margin-right: -0px; " type="button" id="bclose" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
								</div>

							</div>


						</div>


					<!-- </h2>  --> 
				</div>      
				<div class="modal-body" style="color: green">  
				
					<textarea style="width: 97%; margin-right: 10px; margin-bottom: -3px" name="blurb_text" id="write_blurb"  rows="2" ></textarea>
						
					<div>
                    	<br>
                    	<div class="row-fluid">
                    		<div>                        	
									<input type="hidden" id="blurb_id" />
									<input type="hidden" id="fb_w" value="true"/>
									<div id="facebook" style="width:30px; margin-top:4px; text-align:center; float: left; ">
										<a  href="javascript:void(0)">
											<i style="font-size:32px;"  onclick="select_fb_w(this)" class="icon-facebook-sign fb-color icon-only facebook-hover"></i>
										</a>
									</div> 
							
								 
									<input type="hidden" id="twt_w" value="true"/> 
									<div id="twitter" style="width:30px; text-align:center; margin-top:4px; float: left; ">
										<a  href="javascript:void(0)" >
											<i style="font-size:32px;"  onclick="select_twt_w(this)" class="icon-twitter-sign twitter-color icon-only twitter-hover"></i>
										</a>
									</div>
							
									<input type="hidden" id="linkedin_w" value="true"/>  
									<div id="linkedin" style="width:30px; text-align:center; margin-top:4px; float: left; ">
										<a href="javascript:void(0)"  >
											<i style="font-size:32px; color:#4875B4; "  onclick="select_linkedin_w(this)" class="icon-linkedin-sign linkedin-color icon-only linkedin-hover"></i>
										</a>
									</div>
							
                    			
                    		</div>
                    		<div id="scheduleDatetime" style="display:none;">
								<div class=span12><span style="padding-left:15px;">Schedule Time : </span> </div>
								<div class="span12">
									<div class="input-append date form_datetime" data-date="">
									    <input id="inputSchedule" size="16" type="text" value="" readonly>
									    <span class="add-on"><i class="icon-remove"></i></span>
									    <span class="add-on"><i class="icon-th"></i></span>
									</div>
									<span style="padding-left:4px;">
										<button  onclick="set()" type="button" class="btn btn-success btn-small" style="margin-top: -9px;width:50px;">SET</button> 
									</span>
									<span style="padding-left:2px;">
										<button  onclick="cancel()" type="button" class="btn btn-danger btn-small" style="margin-top: -9px;width:65px;">Cancel</button> 
									</span>
								</div>
							</div>
                    		<div style="float: right; ">
                    			
                    			<span style="display: none;" id="reschedule_button">
	                    			<button  onclick="schedule()" class="btn btn-warning btn-small">
	                    				<i class="icon-calendar"></i>Reschedule
	                    			</button>
	                    		</span>
	                    		<span style="display: none;" id="reblurb_button">
	                    			<button id="3" onclick="allpost_w()" class="btn  btn-info btn-small">Re-Blurb</button>
	                    		</span>
	                    		
                    		</div>
                    	</div> <!-- end row-fluid -->
                    </div>


				</div>  
			</div>
			<div class="row-fluid">
				<div class="span11" style="padding-top: 7px; margin-left: 33px">
					<div class="space"></div>
					<div id="calendar"></div>
				</div>
			</div>
			<!-- PAGE CONTENT ENDS -->
		</div><!-- /.span -->
	</div><!-- /.row-fluid -->
</div>
</div>

<script src='../assets/js/jquery-1.9.1.min.js'></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/jquery-ui-1.10.3.custom.min.js"></script>
<script src="../assets/js/fullcalendar.min.js"></script>
<script src="../assets/js/ace.min.js"></script>
<script src="../assets/js/underscore-min.js"></script>
<script src="../assets/js/bootstrap-datetimepicker.min.js" type="text/javascript"></script>
<script src="../assets/js/boxlight/jquery.blImageCenter.js" type="text/javascript"></script>
<script src="../js/topbar.js"></script>
<script src="../js/postFacebook.js"></script>
		<!-- inline scripts related to this page -->
<script type="text/javascript">
	$('#bclose_').click(function(){
		//alert("djfkdf");
		location.reload();
	})
</script>
<script type="text/javascript">
	var find;
	$(".form_datetime").datetimepicker({
        format: "dd MM yyyy - HH:ii P",
        showMeridian: true,
        autoclose: true,
        todayBtn: true,
        startDate: new Date(),
       
    });
	jQuery(function($) {
	/* initialize the external events
		-----------------------------------------------------------------*/
		$('#external-events div.external-event').each(function() {
			// create an Event Object (http://arshaw.com/fullcalendar/docs/event_data/Event_Object/)
			// it doesn't need to have a start or end
			var eventObject = {
				title: $.trim($(this).text()) // use the element's text as the event title
			};
			// store the Event Object in the DOM element so we can get to it later
			$(this).data('eventObject', eventObject);
			// make the event draggable using jQuery UI
			$(this).draggable({
				zIndex: 999,
				revert: true,      // will cause the event to go back to its
				revertDuration: 0  //  original position after the drag
			});
		});
		/* initialize the calendar
		-----------------------------------------------------------------*/
		var formattedEventData = [];
		var historyCallAction = <% if(locals.historyCallAction){ %>
					<%- JSON.stringify(historyCallAction) %>
					<%}%>
		var historyWriteBlurb = <% if(locals.historyWriteBlurb){ %>
					<%- JSON.stringify(historyWriteBlurb) %>
					<%}%>			
		for(var i=0;i<historyCallAction.length;i++){
			formattedEventData.push({
		        title: historyCallAction[i].title,
		        start: new Date(historyCallAction[i].startDatepicker),
		        end: new Date(historyCallAction[i].datepicker),
		        className: 'label-important',
		        allDay: true,
		    });
		}
		for(var i=0;i<historyWriteBlurb.length;i++){
			if(historyWriteBlurb[i].scheduleTime)
			{
				if(historyWriteBlurb[i].status=='Accepted' || historyWriteBlurb[i].post=='Yes'){

					formattedEventData.push({
				        id: historyWriteBlurb[i]._id,
				        title: historyWriteBlurb[i].description.substring(0,15) + '....',
				        start: new Date(historyWriteBlurb[i].scheduleTime),
				        className: 'label-grey',
				        allDay: false,
				        url: '#'
				    });
					
				}
				else{
					formattedEventData.push({
				        id: historyWriteBlurb[i]._id,
				        title: historyWriteBlurb[i].description.substring(0,15) + '....',
				        start: new Date(historyWriteBlurb[i].scheduleTime),
				        className: 'label-success',
				        allDay: false,
				        description: historyWriteBlurb[i].description,
				        url: '#'
				    });
				}
			}
		}
		var calendar = $('#calendar').fullCalendar({
			 buttonText: {
				prev: '<i class="icon-chevron-left"></i>',
				next: '<i class="icon-chevron-right"></i>'
			},
			header: {
				left: 'prev,next today',
				center: 'title',
				right: 'month,agendaWeek,agendaDay'
			},
			events: formattedEventData,
			eventRender: function (event, element) {
	            element.attr('href', 'javascript:void(0);');
	           	element.attr('onclick', 'openModal("'  + event.id + '");');
	        }
			
		
			
		
		});
	})

	function openModal(id) {
		//alert(id);
	    // $("#eventContent").dialog({ modal: true, title: title });
	    var count = 0;
	    find = _.findWhere(historyWriteBlurb,{'_id': id});
	    //console.log(find);
	    if(find.facebookPostId)
	    	count++;
	    if(find.twitterPostId)
	    	count ++;
	    if(find.linkedinPostId)
	    	count ++;
	    if(count > 0){
	    	$('#write_blurb').val(find.description);
		    document.getElementById('writer_name').innerHTML =  find.writer.name  ;
		    if(find.path)
		    	document.getElementById('writer_image').src =  '../' + find.path ;
		    else
		    	document.getElementById('writer_image').src = '../assets/avatars/default.png'; 
		    $('#blurb_id').val(id);  	
		    $('#reblurb_button').show();
		    $('#reschedule_button').show();
		    $('#reblurb_modal').modal();

		}
		else{
			$('#write_blurb').val(find.description);
		    document.getElementById('writer_name').innerHTML =  find.writer.name  ;
		    if(find.path)
		    	document.getElementById('writer_image').src =  '../' + find.path ;
		    else
		    	document.getElementById('writer_image').src = '../assets/avatars/default.png'; 
		    $('#blurb_id').val(id);  
		    $('#reschedule_button').show();
		    $('#reblurb_button').hide();
		    $('#reblurb_modal').modal();

		}
	    
	}
	function select_fb_w(element){
		//var id = $(element);
		var id = $('#fb_w');
		if(id.val()=='true'){
			$(element).addClass('grey');
			id.val('false')
			
		}		
		else{
			$(element).removeClass('grey');
			id.val('true') ;

		}
	}
	function select_twt_w(element){
		var id = $('#twt_w');
		if(id.val()=='true'){
			$(element).addClass('grey');
			id.val('false')
		}		
		else{
			$(element).removeClass('grey');
			id.val('true') ;
		}
	}
	function select_linkedin_w(element){
		var id = $('#linkedin_w');
		if(id.val()=='true'){
			$(element).addClass('grey');
			id.val('false')
		}		
		else{
			$(element).removeClass('grey');
			id.val('true') ;
		}
	}
	function schedule()
	{
		
		var str='#scheduleDatetime';
		$(str).show();
	}
	function cancel()
	{
		
		$('#scheduleDatetime').hide();
	}
	function set()
	{
		console.log(find);
		var facebook=0;
		var twitter=0;
		var linkedin=0;
		var check_fb = $('#fb_w');
		if(check_fb.val()=='true')
		{
			console.log('Check fb success');
			facebook=1;
		}
		var check_twt=$('#twt_w');
		if(check_twt.val()=='true')
		{
			console.log('Check twitter success');
			twitter=1;
		}
		var check_linkedin=$('#linkedin_w');
		if(check_linkedin.val()=='true')
		{
			console.log('Check twitter success');
			linkedin=1;
		}
		var date=$('#inputSchedule').val();
		console.log('date:'+date);
		var dateTimeSplit = date.split(' ');
		var currentDate = dateTimeSplit[0] + '/' + dateTimeSplit[1] + '/' + dateTimeSplit[2];
		console.log(currentDate);
		var currentTime = dateTimeSplit[4] + ' ' + dateTimeSplit[5];
		console.log(currentTime);
		var fullDate = currentDate + " " + currentTime;
		var fullDateReal = new Date(fullDate);
		var iso = fullDateReal.toISOString();
		console.log(iso);
		$('#reblurb_modal').modal('hide');
		$.ajax({ url: '/setRescheduleTime',
	           data: {
	            dateTime:iso,
	            blurbId:find._id,
	            facebook:facebook,
	            twitter:twitter,
	            linkedin:linkedin
	           },
	           type: 'POST',
	           success: function(output) 
	           {
	            console.log(output);
	            $('#scheduleDatetime').hide();
	            $('#hideDiv').hide();
	            $("#schedule_modal").modal();
	           }
	      });
	}
</script>
</body>
</html>
